if("undefined"==typeof jQuery)throw new Error("DCalendar.Picker: This plugin requires jQuery");!function($){Date.prototype.getDays=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};var months=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],short_months=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],daysofweek=["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],short_days=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],ex_keys=[9,112,113,114,115,116,117,118,119,120,121,122,123],DCAL_DATA="dcalendar",DCalendar=function(elem,options){this.elem=$(elem),this.options=options,this.calendar=null,this.today=new Date,this.date=""===this.elem.val()?new Date:this.reformatDate(this.elem.val()).date,this.viewMode="days",this.minDate=this.elem.data("mindate"),this.maxDate=this.elem.data("maxdate"),this.rangeFromEl=this.elem.data("rangefrom"),this.rangeToEl=this.elem.data("rangeto"),this.selected=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate());var that=this;this.create(this.viewMode),this.calendar.find(".calendar-head-card .calendar-date-wrapper").click(function(){that.selected=new Date(that.today.getFullYear(),that.today.getMonth(),that.today.getDate()),that.selectDate(),that.selectedView()}),this.calendar.find(".calendar-prev").click(function(){that.getNewMonth("left",!0)}),this.calendar.find(".calendar-next").click(function(){that.getNewMonth("right",!0)}),this.calendar.find(".calendar-curr-month").click(function(){that.getMonths()}),this.calendar.find(".calendar-date-holder").on("click",".calendar-dates .date:not(.date.month) a",function(){var span=$(this).parent(),day=parseInt($(this).text()),plus=span.hasClass("pm")?-1:span.hasClass("nm")?1:0,selectedDate=new Date(that.date.getFullYear(),that.date.getMonth()+plus,day);that.disabledDate(selectedDate)||(that.selected=selectedDate,that.calendar.find(".calendar-dates .date").removeClass("selected"),span.addClass("selected"),that.selectDate())}).on("click",".calendar-dates .date.month a",function(){var selMonth=parseInt($(this).parent().attr("data-month"));that.viewMode="days",that.date.setMonth(selMonth),that.getNewMonth(null,!1)}),this.getNewMonth(null,!1)};DCalendar.prototype={constructor:DCalendar,reformatDate:function(date,dateFormat){var that=this,format=void 0===dateFormat?this.options.format:dateFormat,dayLength=(format.match(/d/g)||[]).length,monthLength=(format.match(/m/g)||[]).length,yearLength=(format.match(/y/g)||[]).length,isFullMonth=4==monthLength,isMonthNoPadding=1==monthLength,isDayNoPadding=1==dayLength,lastIndex=date.length,firstM=format.indexOf("m"),firstD=format.indexOf("d"),firstY=format.indexOf("y"),month="",day="",year="";if(isFullMonth){var monthIdx=-1;$.each(months,function(i,m){date.indexOf(m)>=0&&(monthIdx=i)}),month=months[monthIdx],firstD=(format=format.replace("mmmm",month)).indexOf("d"),firstY=firstY<firstM?format.indexOf("y"):format.indexOf("y",format.indexOf(month)+month.length)}else if(!isDayNoPadding&&!isMonthNoPadding||isDayNoPadding&&!isMonthNoPadding&&firstM<firstD)month=date.substr(firstM,monthLength);else{var lastIndexM=format.lastIndexOf("m"),before=format.substring(firstM-1,firstM),after=format.substring(lastIndexM+1,lastIndexM+2);month=lastIndexM==format.length-1?date.substring(date.indexOf(before,firstM-1)+1,lastIndex):0==firstM?date.substring(0,date.indexOf(after,firstM)):date.substring(date.indexOf(before,firstM-1)+1,date.indexOf(after,firstM+1))}if(!isDayNoPadding&&!isMonthNoPadding||!isDayNoPadding&&isMonthNoPadding&&firstD<firstM)day=date.substr(firstD,dayLength);else{var lastIndexD=format.lastIndexOf("d");before=format.substring(firstD-1,firstD),after=format.substring(lastIndexD+1,lastIndexD+2),day=lastIndexD==format.length-1?date.substring(date.indexOf(before,firstD-1)+1,lastIndex):0==firstD?date.substring(0,date.indexOf(after,firstD)):date.substring(date.indexOf(before,firstD-1)+1,date.indexOf(after,firstD+1))}if(!isMonthNoPadding&&!isDayNoPadding||isMonthNoPadding&&isDayNoPadding&&firstY<firstM&&firstY<firstD||!isMonthNoPadding&&isDayNoPadding&&firstY<firstD||isMonthNoPadding&&!isDayNoPadding&&firstY<firstM)year=date.substr(firstY,yearLength);else{var before=format.substring(firstY-1,firstY);year=date.substr(date.indexOf(before,firstY-1)+1,yearLength)}return{m:month,d:day,y:year,date:isNaN(parseInt(month))?new Date(month+" "+day+", "+year):new Date(year,month-1,day)}},formatDate:function(format){var d=new Date(this.selected),day=d.getDate(),m=d.getMonth(),y=d.getFullYear();return format.replace(/(yyyy|yy|mmmm|mmm|mm|m|dd|d)/gi,function(e){switch(e.toLowerCase()){case"d":return day;case"dd":return day<10?"0"+day:day;case"m":return m+1;case"mm":return m+1<10?"0"+(m+1):m+1;case"mmm":return short_months[m];case"mmmm":return months[m];case"yy":return y.toString().substr(2,2);case"yyyy":return y}})},selectDate:function(){var that=this,newDate=this.formatDate(this.options.format),e=$.Event("dateselected",{date:newDate});this.elem.trigger(e)},disabledDate:function(date){var that=this,rangeFrom=null,rangeTo=null,rangeMin=null,rangeMax=null,min=null,max=null,now=new Date,today=new Date(now.getFullYear(),now.getMonth(),now.getDate());if(this.minDate&&(min="today"===this.minDate?today:new Date(this.minDate)),this.maxDate&&(max="today"===this.maxDate?today:new Date(this.maxDate)),this.rangeFromEl){var fromEl=$(this.rangeFromEl),fromData=fromEl.data(DCAL_DATA);fromFormat=fromData.options.format,fromVal=fromEl.val(),rangeFrom=this.reformatDate(fromVal,fromFormat).date,rangeMin="today"===fromData.minDate?today:new Date(fromData.minDate)}if(this.rangeToEl){var toEl=$(this.rangeToEl),toData=toEl.data(DCAL_DATA);toFormat=toData.options.format,toVal=toEl.val(),rangeTo=this.reformatDate(toVal,toFormat).date,rangeMax="today"===toData.maxDate?today:new Date(toData.maxDate)}return min&&date<min||max&&date>max||rangeFrom&&date<rangeFrom||rangeTo&&date>rangeTo||rangeMin&&date<rangeMin||rangeMax&&date>rangeMax},getMonths:function(){var that=this,currentYear=this.today.getFullYear(),currentMonth=this.today.getMonth();if("days"===this.viewMode){var cal=this.calendar;curr=cal.find(".calendar-dates"),dayLabel=cal.find(".calendar-labels"),currMonth=cal.find(".calendar-curr-month"),container=cal.find(".calendar-date-holder"),cElem=curr.clone(),rows=[],cells=[],count=0,this.viewMode="months",currMonth.text(this.date.getFullYear()),dayLabel.addClass("invis");for(var i=1;i<4;i++){for(var row=[$("<span class='date month'></span>"),$("<span class='date month'></span>"),$("<span class='date month'></span>"),$("<span class='date month'></span>")],a=0;a<4;a++)row[a].html("<a href='javascript:void(0);'>"+short_months[count]+"</a>").attr("data-month",count),count++;rows.push(row)}$.each(rows,function(i,v){for(var row=$('<span class="cal-row"></span>'),l=v.length,i=0;i<l;i++)row.append(v[i]);cells.push(row)}),container.parent().height(container.parent().outerHeight(!0)),cElem.empty().append(cells).addClass("months load").appendTo(container),curr.addClass("hasmonths"),setTimeout(function(){cElem.removeClass("load")},10),setTimeout(function(){curr.remove()},300)}},getDays:function(newDate,callback){for(var that=this,ndate=new Date(newDate.getFullYear(),newDate.getMonth(),newDate.getDate()),today=new Date(this.today.getFullYear(),this.today.getMonth(),this.today.getDate()),days=ndate.getDays(),day=1,d=new Date(newDate.getFullYear(),newDate.getMonth(),newDate.getDate()),nmStartDay=1,weeks=[],dates=[],i=1;i<=6;i++){for(var week=[$('<span class="date"></span>'),$('<span class="date"></span>'),$('<span class="date"></span>'),$('<span class="date"></span>'),$('<span class="date"></span>'),$('<span class="date"></span>'),$('<span class="date"></span>')];day<=days;){d.setDate(day);var dayOfWeek=d.getDay();if(d.getTime()==today.getTime()&&week[dayOfWeek].addClass("current"),this.disabledDate(d)&&week[dayOfWeek].addClass("disabled"),1===i&&0===dayOfWeek)break;if(!(dayOfWeek<6)){d.getTime()==this.selected.getTime()&&week[dayOfWeek].addClass("selected"),week[dayOfWeek].html('<a href="javascript:void(0);">'+day+++"</a>");break}d.getTime()==this.selected.getTime()&&week[dayOfWeek].addClass("selected"),week[dayOfWeek].html('<a href="javascript:void(0);">'+day+++"</a>")}if(1===i||i>4)if(1===i){var pmDate=new Date(newDate.getFullYear(),newDate.getMonth()-1,1),pMonth=pmDate.getMonth(),pDays=0;pDays=pmDate.getDays();for(var a=6;a>=0;a--)""===week[a].text()&&(pmDate.setDate(pDays),week[a].html('<a href="javascript:void(0);">'+pDays--+"</a>").addClass("pm"),this.disabledDate(pmDate)&&week[a].addClass("disabled"),pmDate.getTime()==this.selected.getTime()&&week[a].addClass("selected"),pmDate.getTime()==today.getTime()&&week[a].addClass("current"))}else if(i>4)for(var nmDate=new Date(d.getFullYear(),d.getMonth()+1,1),a=0;a<=6;a++)""===week[a].text()&&(nmDate.setDate(nmStartDay),week[a].html('<a href="javascript:void(0);">'+nmStartDay+++"</a>").addClass("nm"),this.disabledDate(nmDate)&&week[a].addClass("disabled"),nmDate.getTime()==this.selected.getTime()&&week[a].addClass("selected"),nmDate.getTime()==today.getTime()&&week[a].addClass("current"));weeks.push(week)}$.each(weeks,function(i,v){for(var row=$('<span class="cal-row"></span>'),l=v.length,i=0;i<l;i++)row.append(v[i]);dates.push(row)}),callback(dates)},getNewMonth:function(dir,isTrigger){var that=this,cal=this.calendar;curr=cal.find(".calendar-dates:not(.left):not(.right)"),lblTodayDay=cal.find(".calendar-dayofweek"),lblTodayMonth=cal.find(".calendar-month"),lblTodayDate=cal.find(".calendar-date"),lblTodayYear=cal.find(".calendar-year"),lblMonth=cal.find(".calendar-curr-month"),container=cal.find(".calendar-date-holder"),"days"===this.viewMode?(isTrigger&&(this.date.setDate(1),this.date.setMonth(this.date.getMonth()+("right"===dir?1:-1))),(isTrigger||"calendar"===this.options.mode||curr.hasClass("months"))&&this.getDays(this.date,function(dates){var cElem;if(isTrigger)(cElem=curr.clone()).addClass(dir).empty().append(dates)["left"==dir?"prependTo":"appendTo"](container),setTimeout(function(){curr.addClass("left"==dir?"right":"left"),cElem.removeClass(dir),setTimeout(function(){cal.find(".calendar-dates."+("left"==dir?"right":"left")).remove()},300)},10);else if(curr.hasClass("months")){var cElem=curr.clone();$(".calendar-labels").removeClass("invis"),cElem.empty().append(dates).addClass("hasmonths").appendTo(container),curr.addClass("load"),setTimeout(function(){cElem.removeClass("hasmonths")},10),container.parent().removeAttr("style"),setTimeout(function(){cElem.removeClass("months"),setTimeout(function(){cal.find(".calendar-dates.months").remove()},300)},10)}else curr.append(dates)}),lblMonth.text(months[this.date.getMonth()]+" "+this.date.getFullYear()),isTrigger||curr.hasClass("months")||(lblTodayDay.text(short_days[this.today.getDay()]),lblTodayMonth.text(short_months[this.today.getMonth()]),lblTodayDate.text(this.today.getDate()),lblTodayYear.text(this.today.getFullYear()))):(this.date.setYear(this.date.getFullYear()+("right"===dir?1:-1)),lblMonth.text(this.date.getFullYear()))},selectedView:function(){var that=this,cal=this.calendar;curr=cal.find(".calendar-dates:eq(0)"),lblMonth=cal.find(".calendar-curr-month"),lblDays=cal.find(".calendar-labels"),this.getDays(this.selected,function(dates){curr.html(dates)}),lblMonth.text(months[this.selected.getMonth()]+" "+this.selected.getFullYear()),lblDays.removeClass("invis"),this.viewMode="days"},create:function(){var that=this,mode=that.options.mode,theme=that.options.theme,overlay=$('<div class="calendar-overlay"></div>'),wrapper=$('<div class="calendar-wrapper load"></div>'),cardhead=$('<section class="calendar-head-card"><span class="calendar-year"></span><span class="calendar-date-wrapper" title="Select current date."><span class="calendar-dayofweek"></span>, <span class="calendar-month"></span> <span class="calendar-date"></span></span></section>'),container=$('<div class="calendar-container"></div>'),calhead=$('<section class="calendar-top-selector"><span class="calendar-prev">&lsaquo;</span><span class="calendar-curr-month"></span><span class="calendar-next">&rsaquo;</span></section>'),datesgrid=$('<section class="calendar-grid"><div class="calendar-labels"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div><div class="calendar-date-holder"><section class="calendar-dates"></section></div></section>');switch(calhead.appendTo(container),datesgrid.appendTo(container),overlay.click(function(e){that.hide()}),wrapper.click(function(e){e.stopPropagation()}),wrapper.append(cardhead).append(container).appendTo("calendar"===mode?that.elem:overlay),that.calendar="calendar"===mode?that.elem:wrapper,theme){case"red":case"blue":case"green":case"purple":case"indigo":case"teal":wrapper.attr("data-theme",theme);break;default:wrapper.attr("data-theme",$.fn.dcalendar.defaults.theme)}"calendar"!==mode&&(wrapper.addClass("picker"),overlay.appendTo("body"))},show:function(){$("body").attr("datepicker-display","on"),this.date=new Date(this.selected.getFullYear(),this.selected.getMonth(),this.selected.getDate()),this.selectedView(),this.calendar.parent().fadeIn("fast"),this.calendar.removeClass("load")},hide:function(callback){var that=this;that.calendar.addClass("load"),that.calendar.parent().fadeOut(function(){$("body").removeAttr("datepicker-display"),callback&&callback(),that.elem.is("input")&&that.elem.focus()})}},$.fn.dcalendar=function(opts){return $(this).each(function(index,elem){var that=this,$this=$(this),data=$(this).data(DCAL_DATA),options=$.extend({},$.fn.dcalendar.defaults,$this.data(),"object"==typeof opts&&opts);data||$this.data(DCAL_DATA,data=new DCalendar(this,options)),"string"==typeof opts&&data[opts]()})},$.fn.dcalendar.defaults={mode:"calendar",format:"mm/dd/yyyy",theme:"blue",readOnly:!0},$.fn.dcalendar.Constructor=DCalendar,$.fn.dcalendarpicker=function(opts){return $(this).each(function(){var that=$(this);opts?(opts.mode="datepicker",that.dcalendar(opts)):that.dcalendar({mode:"datepicker"}),that.on("click",function(e){var cal;that.data(DCAL_DATA).show(),this.blur()}).on("dateselected",function(e){var cal=that.data(DCAL_DATA);that.val(e.date).trigger("onchange"),cal.hide(function(){that.trigger($.Event("datechanged",{date:e.date}))})}).on("keydown",function(e){if(ex_keys.indexOf(e.which)<0&&that.data(DCAL_DATA).options.readOnly)return!1}),$(document).on("keydown",function(e){27==e.keyCode&&that.data(DCAL_DATA).hide()})})}}(jQuery);